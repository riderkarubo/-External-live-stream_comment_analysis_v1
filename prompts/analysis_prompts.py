"""AI分析用プロンプト定義"""
from config import COMPANY_NAME

def get_attribute_analysis_prompt(comment_text: str, username: str) -> str:
    """チャットの属性を判定するプロンプトを生成"""
    return f"""以下のライブ配信のコメントを分析し、チャットの属性を判定してください。

ユーザー名: {username}
コメント: {comment_text}
企業名: {COMPANY_NAME}

【判定基準】
ライブ配信では商品紹介や出演者との対話が行われます。コメントの内容、質問の有無、言及対象（商品・出演者・両方）を総合的に判断してください。

【文脈情報】
- ライブ配信では商品（タンブラー、マグカップ、ボトル、バッグなど）の紹介が行われます
- 出演者が商品について説明したり、視聴者の質問に答えたりします
- 視聴者は商品について質問したり、感想を述べたり、購入を検討したりします
- 公式アカウント（{COMPANY_NAME}）が商品情報や購入方法について回答することがあります

【カテゴリ定義（11つの中から1つだけ選択）】

1. 商品に対する質問
   - 商品の価格、サイズ、機能、在庫、購入方法などに関する質問
   - **重要：情報を求めている、答えを期待しているコメントのみが質問です**
   - 疑問詞（何、いくら、どこ、いつ、どう、なぜ、どれ、どの、誰など）を含む商品関連の質問
   - 疑問符（？）を含む商品関連の質問
   - 「みたいです」「見たいです」などの要望表現で、情報を求めている場合のみ含む
   - 例（質問）：「このタンブラーはいくらですか？」「電子レンジ対応できますか？」「在庫ありますか？」「よく見せてください」「見たいです」
   - 例（質問ではない）：
     * 「早く順番こないかなー」- 要望・期待表現（情報を求めていない）
     * 「直接いらないよう」- 情報提供・断り（情報を提供している）
     * 「店内のと区別がつかないのでパートナーさんが大変そう」- 観察・感想（情報を求めていない）
     * 「アンケート答えます」- 意思表明・回答（回答する意思を表明、質問ではない）
     * 「次回はクリスマスイブイブ」- 情報提供・告知（情報を提供している）

2. 出演者に対する質問
   - 出演者の名前、職業、経験、意見などに関する質問
   - **重要：情報を求めている、答えを期待しているコメントのみが質問です**
   - 疑問詞（何、いくら、どこ、いつ、どう、なぜ、どれ、どの、誰など）を含む出演者関連の質問
   - 疑問符（？）を含む出演者関連の質問
   - 例（質問）：「お名前は何ですか？」「この商品どう思いますか？」「何年使っていますか？」
   - 例（質問ではない）：
     * 「いい質問でーす」- 他者への反応・評価（他者の質問への反応、自分が質問しているわけではない）
     * 「まだかえなーい」- 状況報告・期待表現（情報を求めていない）

3. 商品に対するリアクション
   - 商品への感想、評価、コメント全般
   - 商品のみに言及し、質問ではない反応（幅広く判定）
   - 例：「可愛い！」「素敵なデザインですね」「いいですね」

4. 出演者に対するリアクション
   - 出演者への感想、評価、応援メッセージ、コメント全般
   - 出演者のみに言及し、質問ではない反応（幅広く判定）
   - 例：「素敵な方ですね」「応援しています」「かっこいいです」

5. 商品と出演者に対するリアクション
   - 商品と出演者の両方に言及した感想や評価
   - 両方に言及しているが、質問ではない反応
   - 例：「商品も出演者も素敵です」「両方とも気に入りました」

6. 配信に対するリアクション
   - 配信全体やライブ配信そのものに対する感想、評価、コメント
   - 商品や出演者に直接言及していないが、配信に対する反応
   - 例：「楽しい配信です」「面白い！」「いい時間ですね」

7. 公式コメント
   - user_typeが"moderator"の場合のみ
   - 公式アカウントからの情報提供や返答
   - 例：「店舗でのお取り扱い商品は開店時間からご購入いただけます」

8. 絵文字のみ
   - 本当に絵文字だけ入っている時だけ。テキスト（文字）が含まれている場合は絵文字のみに分類しない。
   - 例：「🎉」「👋」「❤️」
   - 例（絵文字のみではない）：「ゴージャスピンク💗」（テキストが含まれている）

9. 不満の声
   - 返金要求、不満、批判的な要望や意見
   - 例：「返金してください」「買えない」「見れない」「不満です」

10. 購入検討
    - 購入を検討している、悩んでいる、欲しいという意思表示
    - 例：「悩む」「欲しいです」「検討中です」「迷っています」「使いたい」

11. 購入報告
    - 購入した、注文したという報告
    - 例：「買えました」「ポチりました」「注文しました」「購入しました」

12. お礼・感謝
    - お礼や感謝の気持ちを表すコメント。商品や出演者、配信に対する感謝のメッセージ。
    - 例：「ありがとうございます」「感謝です」「ありがとう」「お礼です」

13. その他
    - 上記に該当しないコメント
    - 質問ではなく、回答や情報提供のコメント（アンケートへの回答、次回の予定告知など）
    - 意味不明な文字列など
    - 例：「アンケート答えます」「次回はクリスマスイブイブ」「ありがとうございます（単なる感謝のみ）」

【判定のポイント】
- **質問かどうかの判定（最重要）**：
  * 疑問詞や疑問符の有無だけでなく、**情報を求めているかどうか**を必ず確認してください
  * 情報を求めている、答えを期待しているコメントのみが質問です
  * 質問ではないもの：
    - 要望・期待表現（「〜かなー」「〜ないかな」など）- 情報を求めているわけではなく、状況への期待や要望を述べている
    - 情報提供・告知（「〜です」「〜ます」など）- 情報を提供している、質問ではなく回答
    - 状況報告・感想（「〜です」「〜そう」など）- 状況や感想を述べている、情報を求めていない
    - 他者への反応・評価（「いい質問でーす」など）- 他者の質問への反応、自分が質問しているわけではない
    - 意思表明・回答（「答えます」など）- 回答する意思を表明している、質問ではない
  * 「みたいです」「見たいです」は、情報を求めている場合のみ「商品に対する質問」に分類。単なる要望表現の場合は「その他」に分類
- 言及対象：商品のみ→「商品に対する質問/リアクション」、出演者のみ→「出演者に対する質問/リアクション」、両方→「商品と出演者に対するリアクション」、配信全体→「配信に対するリアクション」
- 不満の声判定：「返金してください」「買えない」「見れない」など、ネガティブな要望や意見は「不満の声」に分類
- 購入関連：「欲しい」「悩む」「使いたい」などは「購入検討」、「買えました」「ポチりました」などは「購入報告」に分類
- 境界ケース：商品と出演者の両方に言及しているが質問の場合は、より主要な対象を判断。どちらか一方が明確な場合はそちらを選択。
- リアクションの判定：質問ではないが、商品や出演者に対する感想や評価を述べている場合は「リアクション」に分類。配信全体に対する感想や評価は「配信に対するリアクション」に分類。幅広く判定してください。
- 絵文字のみの判定：本当に絵文字だけ入っている時だけ「絵文字のみ」に分類。テキスト（文字）が含まれている場合は、テキストの内容で判定してください。テキストと絵文字が混在している場合は、絵文字のみに分類しない。
- お礼・感謝の判定：「ありがとうございます」「感謝です」「ありがとう」「お礼です」など、お礼や感謝の気持ちを表すコメントは「お礼・感謝」に分類。

【回答形式】
上記の13つのカテゴリから1つだけ選択し、カテゴリ名のみを出力してください。

例：
商品に対する質問
出演者に対する質問
商品に対するリアクション
出演者に対するリアクション
配信に対するリアクション
不満の声
購入検討
購入報告
お礼・感謝
絵文字のみ
その他

重要：
- カテゴリ名のみを出力してください（番号は不要）
- 説明文やその他のテキストは含めないでください
- 上記の11つのカテゴリから1つだけ選択してください"""

def get_sentiment_analysis_prompt(comment_text: str) -> str:
    """チャット感情を判定するプロンプトを生成"""
    return f"""以下のライブ配信のコメントを分析し、感情を判定してください。

コメント: {comment_text}

【判定基準】
コメントに含まれる感情的な表現、評価、態度を総合的に判断してください。文脈や語調も考慮します。

【文脈情報】
- ライブ配信では商品紹介や出演者との対話が行われます
- 視聴者は商品について質問したり、感想を述べたり、購入を検討したりします
- 質問や要望のみのコメントは感情が明確でない場合が多いです
- クレームや不満を述べているコメントはネガティブな感情を持っています

【カテゴリ定義（6つの中から1つだけ選択）】

1. ポジティブ
   - 明確に肯定的、好意的、賞賛的な感情
   - 強い喜び、興奮、感謝、称賛などの表現
   - 手を振るような絵文字（👋、🙋など）やクラッカー（🎉）などポジティブと思われる絵文字も含む
   - 例：「素敵です！」「ありがとうございます」「可愛い！」「最高です！」「👋」「🎉」

2. ややポジティブ
   - やや肯定的、好意的な感情
   - 軽い喜び、好意的な反応などの表現
   - 例：「いいですね」「良いと思います」

3. どちらでもない
   - 感情が明確でない、中立的、事実確認のみ
   - 質問のみ、情報確認のみ、要望のみ、感情表現がない
   - 例：「いくらですか？」「在庫ありますか？」「電子レンジ対応できますか？」「よく見せてください」

4. ややネガティブ
   - やや否定的、不満な感情
   - 軽い不満、懸念などの表現
   - 不満だけど、怒りの感情が伝わらないもの
   - 例：「少し高いですね」「心配です」

5. ネガティブ
   - 明確に否定的、批判的、不満な感情
   - 強い不満、批判、失望、怒りなどの表現
   - 不満な感情が伝わるコメント（返金要求、買えない、いつになったらつながるのよなど）
   - 例：「高いですね」「不満です」「返金してください」「買えない」「見れない」「いつになったらつながるのよ」

6. 混在
   - ポジティブとネガティブが明確に混在している
   - 良い点と悪い点の両方を述べている
   - 例：「デザインは良いけど、値段が高い」「欲しいけど、在庫がない」

【判定のポイント】
- 質問や要望のみのコメント（「よく見せてください」など）は「どちらでもない」に分類
- 不満な感情が伝わるコメント（「返金してください」「買えない」「いつになったらつながるのよ」など）は「ネガティブ」に分類
- 不満だけど、怒りの感情が伝わらないものは「ややネガティブ」に分類
- 感情的な表現の強さで「ポジティブ」と「ややポジティブ」、「ネガティブ」と「ややネガティブ」を区別
- 感情的な表現（「！」「〜です」「〜ですね」など）があるかで判断
- 絵文字の判定：手を振るような絵文字（👋、🙋など）やクラッカー（🎉）などポジティブと思われる絵文字は「ポジティブ」として判定

【回答形式】
上記の6つのカテゴリから1つだけ選択し、カテゴリ名のみを出力してください。

例：
ポジティブ
ややポジティブ
どちらでもない
ややネガティブ
ネガティブ
混在

重要：
- カテゴリ名のみを出力してください（番号は不要）
- 説明文やその他のテキストは含めないでください
- 上記の6つのカテゴリから1つだけ選択してください"""

def get_combined_analysis_prompt(comment_text: str, username: str) -> str:
    """属性と感情を同時に分析する統合プロンプトを生成"""
    return f"""以下のライブ配信のコメントを分析し、チャットの属性と感情の両方を判定してください。

ユーザー名: {username}
コメント: {comment_text}
企業名: {COMPANY_NAME}

【判定基準】
ライブ配信では商品紹介や出演者との対話が行われます。コメントの内容、質問の有無、言及対象（商品・出演者・両方）、感情表現を総合的に判断してください。

【文脈情報】
- ライブ配信では商品（タンブラー、マグカップ、ボトル、バッグなど）の紹介が行われます
- 出演者が商品について説明したり、視聴者の質問に答えたりします
- 視聴者は商品について質問したり、感想を述べたり、購入を検討したりします
- 公式アカウント（{COMPANY_NAME}）が商品情報や購入方法について回答することがあります
- 質問や要望のみのコメントは感情が明確でない場合が多いです
- クレームや不満を述べているコメントはネガティブな感情を持っています

【属性カテゴリ（13つの中から1つだけ選択）】

1. 商品に対する質問 - 商品の価格、サイズ、機能、在庫、購入方法などに関する質問。**重要：情報を求めている、答えを期待しているコメントのみが質問です**。疑問詞（何、いくら、どこ、いつ、どう、なぜ、どれ、どの、誰など）や疑問符（？）を含む商品関連の質問。「みたいです」「見たいです」などの要望表現で、情報を求めている場合のみ含む。
   例（質問）：「このタンブラーはいくらですか？」「電子レンジ対応できますか？」「よく見せてください」「見たいです」
   例（質問ではない）：「早く順番こないかなー」（要望・期待表現）、「直接いらないよう」（情報提供）、「店内のと区別がつかないのでパートナーさんが大変そう」（観察・感想）、「アンケート答えます」（意思表明）、「次回はクリスマスイブイブ」（情報提供）

2. 出演者に対する質問 - 出演者の名前、職業、経験、意見などに関する質問。**重要：情報を求めている、答えを期待しているコメントのみが質問です**。疑問詞（何、いくら、どこ、いつ、どう、なぜ、どれ、どの、誰など）や疑問符（？）を含む出演者関連の質問。
   例（質問）：「お名前は何ですか？」「この商品どう思いますか？」
   例（質問ではない）：「いい質問でーす」（他者への反応）、「まだかえなーい」（状況報告・期待表現）

3. 商品に対するリアクション - 商品への感想、評価、コメント全般。商品のみに言及し、質問ではない反応（幅広く判定）。
   例：「可愛い！」「素敵なデザインですね」「いいですね」

4. 出演者に対するリアクション - 出演者への感想、評価、応援メッセージ、コメント全般。出演者のみに言及し、質問ではない反応（幅広く判定）。
   例：「素敵な方ですね」「応援しています」

5. 商品と出演者に対するリアクション - 商品と出演者の両方に言及した感想や評価。両方に言及しているが、質問ではない反応。
   例：「商品も出演者も素敵です」

6. 配信に対するリアクション - 配信全体やライブ配信そのものに対する感想、評価、コメント。商品や出演者に直接言及していないが、配信に対する反応。
   例：「楽しい配信です」「面白い！」「いい時間ですね」

7. 公式コメント - user_typeが"moderator"の場合のみ。公式アカウントからの情報提供や返答。

8. 絵文字のみ - 本当に絵文字だけ入っている時だけ。テキスト（文字）が含まれている場合は絵文字のみに分類しない。
   例：「🎉」「👋」「❤️」
   例（絵文字のみではない）：「ゴージャスピンク💗」（テキストが含まれている）

9. 不満の声 - 返金要求、不満、批判的な要望や意見。
   例：「返金してください」「買えない」「見れない」「不満です」

10. 購入検討 - 購入を検討している、悩んでいる、欲しいという意思表示。
    例：「悩む」「欲しいです」「検討中です」「迷っています」「使いたい」

11. 購入報告 - 購入した、注文したという報告。
    例：「買えました」「ポチりました」「注文しました」「購入しました」

12. お礼・感謝 - お礼や感謝の気持ちを表すコメント。商品や出演者、配信に対する感謝のメッセージ。
    例：「ありがとうございます」「感謝です」「ありがとう」「お礼です」

13. その他 - 上記に該当しないコメント。質問ではなく、回答や情報提供のコメント（アンケートへの回答、次回の予定告知など）。意味不明な文字列など。
    例：「アンケート答えます」「次回はクリスマスイブイブ」

【感情カテゴリ（6つの中から1つだけ選択）】

1. ポジティブ - 明確に肯定的、好意的、賞賛的な感情。強い喜び、興奮、感謝、称賛などの表現。手を振るような絵文字（👋、🙋など）やクラッカー（🎉）などポジティブと思われる絵文字も含む。
   例：「素敵です！」「ありがとうございます」「可愛い！」「最高です！」「👋」「🎉」

2. ややポジティブ - やや肯定的、好意的な感情。軽い喜び、好意的な反応などの表現。
   例：「いいですね」「良いと思います」

3. どちらでもない - 感情が明確でない、中立的、事実確認のみ。質問のみ、情報確認のみ、要望のみ、感情表現がない。
   例：「いくらですか？」「在庫ありますか？」「よく見せてください」

4. ややネガティブ - やや否定的、不満な感情。軽い不満、懸念などの表現。不満だけど、怒りの感情が伝わらないもの。
   例：「少し高いですね」「心配です」

5. ネガティブ - 明確に否定的、批判的、不満な感情。強い不満、批判、失望、怒りなどの表現。不満な感情が伝わるコメント（返金要求、買えない、いつになったらつながるのよなど）。
   例：「高いですね」「不満です」「返金してください」「買えない」「見れない」「いつになったらつながるのよ」

6. 混在 - ポジティブとネガティブが明確に混在している。良い点と悪い点の両方を述べている。
   例：「デザインは良いけど、値段が高い」

【回答形式】
属性と感情の両方を1行で出力してください。形式は以下の通りです：

属性: [属性カテゴリ名]
感情: [感情カテゴリ名]

例：
属性: 商品に対するリアクション
感情: ポジティブ

属性: 商品に対する質問
感情: どちらでもない

属性: 不満の声
感情: ネガティブ

属性: 購入検討
感情: ややポジティブ

属性: 購入報告
感情: ポジティブ

属性: お礼・感謝
感情: ポジティブ

属性: 絵文字のみ
感情: どちらでもない

重要な注意事項：
- 「属性:」と「感情:」の2行で出力してください
- カテゴリ名は上記のリストに記載された名前をそのまま使用してください（番号は不要）
- **質問の判定（最重要）**：情報を求めている、答えを期待しているコメントのみが質問です。以下のコメントは質問ではありません：
  * 「早く順番こないかなー」- 要望・期待表現（情報を求めていない）
  * 「直接いらないよう」- 情報提供・断り（情報を提供している）
  * 「オンラインストア2万人まちです笑このライブがいい時間になってます～♪」- 状況報告・感想（情報を求めていない）
  * 「店内のと区別がつかないのでパートナーさんが大変そう」- 観察・感想（情報を求めていない）
  * 「いい質問でーす」- 他者への反応・評価（他者の質問への反応）
  * 「まだかえなーい」- 状況報告・期待表現（情報を求めていない）
  * 「アンケート答えます」- 意思表明・回答（回答する意思を表明）
  * 「次回はクリスマスイブイブ」- 情報提供・告知（情報を提供している）
- 「みたいです」「見たいです」は、情報を求めている場合のみ「商品に対する質問」に分類。単なる要望表現の場合は「その他」に分類してください
- 「よく見せてください」など商品に対する質問で情報を求めている場合は「商品に対する質問」に分類し、感情は「どちらでもない」に分類してください
- 「返金してください」「買えない」「いつになったらつながるのよ」など不満な感情が伝わるコメントは「不満の声」に分類し、感情は「ネガティブ」に分類してください
- 不満だけど、怒りの感情が伝わらないものは「ややネガティブ」に分類してください
- 「使いたい」など購入を検討している意思表示は「購入検討」に分類してください
- 絵文字のみの判定：本当に絵文字だけ入っている時だけ「絵文字のみ」に分類。テキスト（文字）が含まれている場合は、テキストの内容で判定してください。「ゴージャスピンク💗」のようにテキストと絵文字が混在している場合は、絵文字のみに分類しない。
- 「ありがとうございます」「感謝です」「ありがとう」「お礼です」など、お礼や感謝の気持ちを表すコメントは「お礼・感謝」に分類してください
- 絵文字の判定：手を振るような絵文字（👋、🙋など）やクラッカー（🎉）などポジティブと思われる絵文字は「ポジティブ」として判定してください
- 属性カテゴリは13つの中から1つだけ、感情カテゴリは6つの中から1つだけ選択してください"""

def is_question_attribute(attribute: str) -> bool:
    """属性が質問系かどうかを判定"""
    question_attributes = [
        "商品に対する質問",
        "出演者に対する質問"
    ]
    return attribute in question_attributes


def get_question_answer_match_prompt(question_text: str, answer_text: str) -> str:
    """質問と回答の照合判定用プロンプトを生成"""
    return f"""以下の質問と回答のテキストを分析し、回答が質問に対する回答になっているかを判定してください。

質問: {question_text}

回答: {answer_text}

回答が質問に対する回答になっている場合は「YES」、そうでない場合は「NO」とだけ回答してください。
文脈や意味を考慮して判定してください。言い回しが異なっていても、質問の内容に対して回答になっている場合は「YES」と判定してください。

回答（YESまたはNOのみ）:"""


